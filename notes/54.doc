First need to install eksctl.

It is a simple CLI tool for creating and managing Kubernetes clusters on Amazon EKS.

OIDC Connector

ALB Ingress Controller is a pod that runs in the cluster.
It need access to create a load balancer outside the cluster and inside the VPC.
So we need to create an IAM role and attach it to the service account of that the ALB.
This can be done by creating an OIDC provider for the cluster.

Setup OIDC Connector

commands to configure IAM OIDC provider

export cluster_name=demo-cluster

oidc_id=$(aws eks describe-cluster --name $cluster_name --query "cluster.identity.oidc.issuer" --output text | cut -d '/' -f 5) 
This command extracts the OIDC ID from the cluster's identity issuer URL.

Check if there is an IAM OIDC provider configured already
aws iam list-open-id-connect-providers | grep $oidc_id | cut -d "/" -f4\n

If not, run the below command

eksctl utils associate-iam-oidc-provider --cluster $cluster_name --approve

Download IAM policy - aws provides a predefined policy for the ALB Ingress controller.

curl -O https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.11.0/docs/install/iam_policy.json

Create IAM Policy

aws iam create-policy \
    --policy-name AWSLoadBalancerControllerIAMPolicy \
    --policy-document file://iam_policy.json

Create IAM Role

eksctl create iamserviceaccount \
  --cluster=<your-cluster-name> \
  --namespace=kube-system \
  --name=aws-load-balancer-controller \
  --role-name AmazonEKSLoadBalancerControllerRole \
  --attach-policy-arn=arn:aws:iam::<your-aws-account-id>:policy/AWSLoadBalancerControllerIAMPolicy \
  --approve

Deploy ALB controller

Helm is basically the package manager for Kubernetes (like apt for Ubuntu or npm for Node.js).

Instead of writing long YAML manifests for every deployment, service, configmap, etc., Helm lets you install applications into your Kubernetes cluster 
using pre-packaged bundles called Helm charts.

ðŸ“¦ What is a Helm Chart?

A Helm Chart is a collection of YAML templates that describe a Kubernetes application (like NGINX, Prometheus, EKS add-ons, etc.).

You install it with a single command

Helm renders and applies all the Kubernetes YAMLs for you

Installing Helm

$ curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
$ chmod 700 get_helm.sh
$ ./get_helm.sh

Add helm repo
helm repo add eks https://aws.github.io/eks-charts

Update the repo
helm repo update eks

Install

helm install aws-load-balancer-controller eks/aws-load-balancer-controller \            
  -n kube-system \
  --set clusterName=<your-cluster-name> \
  --set serviceAccount.create=false \
  --set serviceAccount.name=aws-load-balancer-controller \
  --set region=<region> \
  --set vpcId=<your-vpc-id>

Verify that the deployments are running.

kubectl get deployment -n kube-system aws-load-balancer-controller





